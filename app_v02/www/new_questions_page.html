<html>
	<head>
		<meta charset="utf-8">
		<title>Fragen hinzufügen</title>
		<link rel="stylesheet" type="text/css" href="css/style.css" />
	
		<!--<script src="jquery-1.8.3.min.js"></script>-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>      
        <script type="text/javascript" charset="utf-8">

             function onLoad()
             {
                  document.addEventListener("deviceready", onDeviceReady, true);
             }

             function onDeviceReady()
             {
                  // navigator.notification.alert("PhoneGap is working");
             }
			 function callMainMenu()
             {
                window.location = "index.html";
             }

        </script>
	
	</head>
	
	<body>
		
		<div id="nav_bar">
			<button id="nav_back_button" type="button" onclick="callMainMenu()"><img id="arrow_back" src="images/arrow_left_black.svg" alt="Back"></button>
		</div>
	
		<div id="content_newQuestions">
		
		<h1>Neue Frage anlegen:</h1>
		
		<p>Hier können Sie neue Fragen anlegen.</p>
		
		<div id="category_1">
			<button id="button_c1" class="category_button" type="button" onclick="buttonC1click()"><img id="arrow_C1" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C1" class="p_new_questions"></p>
		</div>

		<div id="category_2">
			<button id="button_c2" class="category_button" type="button" onclick="buttonC2click()"><img id="arrow_C2" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C2" class="p_new_questions"></p>
		</div>
		
		<div id="category_3">
			<button id="button_c3" class="category_button" type="button" onclick="buttonC3click()"><img id="arrow_C3" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C3" class="p_new_questions"></p>
		</div>
		
		<div id="category_4">
			<button id="button_c4" class="category_button" type="button" onclick="buttonC4click()"><img id="arrow_C4" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C4" class="p_new_questions"></p>
		</div>
		
		<div id="category_5">
			<button id="button_c5" class="category_button" type="button" onclick="buttonC5click()"><img id="arrow_C5" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C5" class="p_new_questions"></p>
		</div>
		
		<div id="category_6">
			<button id="button_c6" class="category_button" type="button" onclick="buttonC6click()"><img id="arrow_C6" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C6" class="p_new_questions"></p>
		</div>
		
		<div id="category_7">
			<button id="button_c7" class="category_button" type="button" onclick="buttonC7click()"><img id="arrow_C7" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C7" class="p_new_questions"></p>
		</div>
		
		<div id="category_8">
			<button id="button_c8" class="category_button" type="button" onclick="buttonC8click()"><img id="arrow_C8" class="arrow_down" src="images/arrow_down_black.svg" alt="unfold"><span></span></button>
			<p id="content_C8" class="p_new_questions"></p>
		</div>
		
		
					
		<script type="text/javascript">
		
			var buttonC1clicked = false;
			var buttonC2clicked = false;
			var buttonC3clicked = false;
			var buttonC4clicked = false;
			var buttonC5clicked = false;
			var buttonC6clicked = false;
			var buttonC7clicked = false;
			var buttonC8clicked = false;
		
			$(document).ready(function(){
				
				$.getJSON("http://pcrw00023.uni-regensburg.de:10080/php/get_json_from_db.php", function( data ) {
				
					var json = JSON.parse(data.JSON_from_Server[0].JSON_File);
				
					$('#category_1 > button > span').text(json.categories[0].category_name);
					
					$('#category_2 > button > span').text(json.categories[1].category_name);
					
					$('#category_3 > button > span').text(json.categories[2].category_name);
					
					$('#category_4 > button > span').text(json.categories[3].category_name);
					
					$('#category_5 > button > span').text(json.categories[4].category_name);
					
					$('#category_6 > button > span').text(json.categories[5].category_name);
					
					$('#category_7 > button > span').text(json.categories[6].category_name);
					
					$('#category_8 > button > span').text(json.categories[7].category_name);
				
				});
			
			})
			
			var formText = "<label>Frage: </label>" + '<input type="text" name="q" class="form-control" />' + "<br />" +   
				    "<label>Antwort: </label>" + '<input type="text" name="ca" class="form-control" />' + "<br />" +  
				    "<label>Falsche erste Antwort: </label>" + '<input type="text" name="wa01" class="form-control" />' + "<br />" + 
				    "<label>Falsche zweite Antwort: </label>" + '<input type="text" name="wa02" class="form-control" />' + "<br />" + 
				    "<label>Falsche dritte Antwort: </label>" + '<input type="text" name="wa03" class="form-control" />' + "<br />" + 
				    '<input type="submit" name="submit" value="Hinzufügen" class="submit_button" />' + "<br />" + 
					"</form>";
		
			function buttonC1click(){
				if(buttonC1clicked == false){
					button_c1.style.background = "#aea700";
					document.getElementById("arrow_C1").src = "images/arrow_right_black.svg";
					buttonC1clicked = true;
					document.getElementById("content_C1").innerHTML = "<b>" + "Frage in Kategorie 1 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 1); return false;">' +
					formText;
				} else {
					button_c1.style.background = "#bdc3c7";
					document.getElementById("arrow_C1").src = "images/arrow_down_black.svg";
					buttonC1clicked = false;
					document.getElementById("content_C1").innerHTML = "";
				}
			}
			
			function buttonC2click(){
				if(buttonC2clicked == false){
					button_c2.style.background = "#aea700";
					document.getElementById("arrow_C2").src = "images/arrow_right_black.svg";
					buttonC2clicked = true;
					document.getElementById("content_C2").innerHTML = "<b>" + "Frage in Kategorie 2 hinzufügen: " + "</b>" + "<br>" +
					'<form onsubmit="make_json(this, 2); return false;">' +
					formText;
				} else {
					button_c2.style.background = "#bdc3c7";
					document.getElementById("arrow_C2").src = "images/arrow_down_black.svg";
					buttonC2clicked = false;
					document.getElementById("content_C2").innerHTML = "";
				}
			}
			
			function buttonC3click(){
				if(buttonC3clicked == false){
					button_c3.style.background = "#aea700";
					document.getElementById("arrow_C3").src = "images/arrow_right_black.svg";
					buttonC3clicked = true;
					document.getElementById("content_C3").innerHTML = "<b>" + "Frage in Kategorie 3 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 3); return false;">' +
					formText;
				} else {
					button_c3.style.background = "#bdc3c7";
					document.getElementById("arrow_C3").src = "images/arrow_down_black.svg";
					buttonC3clicked = false;
					document.getElementById("content_C3").innerHTML = "";
				}
			}
			
			function buttonC4click(){
				if(buttonC4clicked == false){
					button_c4.style.background = "#aea700";
					document.getElementById("arrow_C4").src = "images/arrow_right_black.svg";
					buttonC4clicked = true;
					document.getElementById("content_C4").innerHTML = "<b>" + "Frage in Kategorie 4 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 4); return false;">' +
					formText;
				} else {
					button_c4.style.background = "#bdc3c7";
					document.getElementById("arrow_C4").src = "images/arrow_down_black.svg";
					buttonC4clicked = false;
					document.getElementById("content_C4").innerHTML = "";
				}
			}
			
			function buttonC5click(){
				if(buttonC5clicked == false){
					button_c5.style.background = "#aea700";
					document.getElementById("arrow_C5").src = "images/arrow_right_black.svg";
					buttonC5clicked = true;
					document.getElementById("content_C5").innerHTML = "<b>" + "Frage in Kategorie 5 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 5); return false;">' +
					formText;
				} else {
					button_c5.style.background = "#bdc3c7";
					document.getElementById("arrow_C5").src = "images/arrow_down_black.svg";
					buttonC5clicked = false;
					document.getElementById("content_C5").innerHTML = "";
				}
			}
			
			function buttonC6click(){
				if(buttonC6clicked == false){
					button_c6.style.background = "#aea700";
					document.getElementById("arrow_C6").src = "images/arrow_right_black.svg";
					buttonC6clicked = true;
					document.getElementById("content_C6").innerHTML = "<b>" + "Frage in Kategorie 6 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 6); return false;">' +
					formText;
				} else {
					button_c6.style.background = "#bdc3c7";
					document.getElementById("arrow_C6").src = "images/arrow_down_black.svg";
					buttonC6clicked = false;
					document.getElementById("content_C6").innerHTML = "";
				}
			}
			
			function buttonC7click(){
				if(buttonC7clicked == false){
					button_c7.style.background = "#aea700";
					document.getElementById("arrow_C7").src = "images/arrow_right_black.svg";
					buttonC7clicked = true;
					document.getElementById("content_C7").innerHTML = "<b>" + "Frage in Kategorie 7 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 7); return false;">' +
					formText;
				} else {
					button_c7.style.background = "#bdc3c7";
					document.getElementById("arrow_C7").src = "images/arrow_down_black.svg";
					buttonC7clicked = false;
					document.getElementById("content_C7").innerHTML = "";
				}
			}
			
			function buttonC8click(){
				if(buttonC8clicked == false){
					button_c8.style.background = "#aea700";
					document.getElementById("arrow_C8").src = "images/arrow_right_black.svg";
					buttonC8clicked = true;
					document.getElementById("content_C8").innerHTML = "<b>" + "Frage in Kategorie 8 hinzufügen: " + "</b>" + "<br>" + 
					'<form onsubmit="make_json(this, 8); return false;">' +
					formText;
				} else {
					button_c8.style.background = "#bdc3c7";
					document.getElementById("arrow_C8").src = "images/arrow_down_black.svg";
					buttonC8clicked = false;
					document.getElementById("content_C8").innerHTML = "";
				}
			}
			
			var noError = "<b>" + "<font color='green'>" + "Frage hinzugefügt!" + "</font>" + "</b>" + "<br/>";
			var error = "<b>" + "<font color='red'>" + "Alle Eingabefelder ausfüllen!" + "</font>" + "</b>" + "<br/>";
			
		
			function make_json(form, cID){
			
				var section = "";
				
				if(cID == 1){
					section = "content_C1";
				}
				if(cID == 2){
					section = "content_C2";
				}
				if(cID == 3){
					section = "content_C3";
				}
				if(cID == 4){
					section = "content_C4";
				}
				if(cID == 5){
					section = "content_C5";
				}
				if(cID == 6){
					section = "content_C6";
				}
				if(cID == 7){
					section = "content_C7";
				}
				if(cID == 8){
					section = "content_C8";
				}
			
				var missingInput = false;
			
				if(form.q.value == ""){
					missingInput = true;
				}
				if(form.ca.value == "") {
					missingInput = true;
				}
				if(form.wa01.value == "") {
					missingInput = true;
				}
				if(form.wa02.value == "") {
					missingInput = true;
				}
				if(form.wa03.value == "") {
					missingInput = true;
				}
			
				var newJson = {
					"q": form.q.value,
					"ca": form.ca.value,
					"wa01": form.wa01.value,
					"wa02": form.wa02.value,
					"wa03":form.wa03.value
				};
				
				if(missingInput == false){
				
					var formData = JSON.stringify(newJson);
					
					formData = JSON.parse(formData);
			
					var jsonIssues = {};
		
					$.ajax({
						url: "http://pcrw00023.uni-regensburg.de:10080/php/get_json_from_db.php",
						async: false,
						dataType: 'json',
						success: function(data) {
							jsonIssues = data;
						}
					});
				
					var myJSON = JSON.parse(jsonIssues.JSON_from_Server[0].JSON_File);
					
					myJSON.categories[cID - 1].questions.splice(1, 0, formData);
					
					myJSON = JSON.stringify(myJSON);
					
					$.ajax({
						type: "POST",
						dataType: "json",
						url: "http://pcrw00023.uni-regensburg.de:10080/php/save_json_in_db.php",
						data: {Input_data:myJSON},
						success: function(data){
						},
						error: function(e){
							console.log(e.message);
						}
					});
					
					document.getElementById(section).innerHTML = noError;
					
				} else {
					document.getElementById(section).innerHTML = error;
				}
			}
		
		</script>
		
		</div>
		
	</body>
</html>