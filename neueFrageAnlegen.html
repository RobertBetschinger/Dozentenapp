<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Neue Frage Anlegen</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <link rel="stylesheet" href="css/tailwindStyle.css">
    
    <style>
      .gradient {
        background: linear-gradient(90deg, #939492 0%, #6c7597 100%);
      }
      #menu-toggle:checked + #menu {
          display: block;
        }
    </style>
    <script type="text/javascript" charset="utf-8">
      document.addEventListener("deviceready", onDeviceReady, true);

      function onLoad() {
          document.addEventListener("deviceready", onDeviceReady, true);
      }

      function onDeviceReady() {
          // navigator.notification.alert("PhoneGap is working");
          document.addEventListener("offline", onOffline, false);
          document.addEventListener("online", onOnline, false);
      }

      function callMainMenu() {
          window.location = "index.html";
      }

      function onOffline() {
          alert("Keine Internetverbindung! App nur eingeschränkt verwendungsfähig.");
      }

      function onOnline() {
          alert("Internetverbindung wieder vorhanden.");
      }
      function callDozentenappPage(){
        window.location="HomeScreen.html"
      }
      function callExistingQuestionsPage()
           {
              window.location = "fragenBearbeiten.html";
           }
     
     function callNewQuestionsPage()
           {
              window.location = "NeueFrageAnlegen.html";
           }

     function callNewCategoryPage(){
       window.location ="neueKategorieAnlegen.html";
     }
     
     function callStudentPerformancePage()
           {
              window.location = "student_performance_page.html";
           }
     
     function callUsageOverviewPage()
     {
      window.location = "usage_overview_page.html";
     }
  </script>

  
   
</head>

<body >


    <header class="lg:px-16 px-6 bg-green-600 h-auto md:h-24 flex flex-wrap items-center lg:py-0 py-2">
              
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-4 h-4 opacity-75">
            <path d="M3.33 8L10 12l10-6-10-6L0 6h10v2H3.33zM0 8v8l2-2.22V9.2L0 8zm10 12l-5-3-2-1.2v-6l7 4.2 7-4.2v6L10 20z"/></svg>
            <span class="font-semibold text-2xl tracking-tight m-2">Universität Regensburg</span>
          </div>
    
      <label for="menu-toggle" class="pointer-cursor lg:hidden block"><svg class="fill-current text-gray-900" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><title>menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></label>
      <input class="hidden" type="checkbox" id="menu-toggle" />
    
      <div class="hidden lg:flex lg:items-center lg:w-auto w-full" id="menu">
        <div class="text-sm lg:flex-grow ">
            <a href="#responsive-header" class="block mt-4 w-1/8 pl-6 pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white mr-4 text-base">
              <button id="existing_questions_button" class="button_main" type="button" onclick="callDozentenappPage()">Dozentenapp</button>
            <a href="#responsive-header" class="block mt-4  w-1/8 pl-6  pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white mr-4 text-base">        		 
                  <button id="new_question_button" class="button_main" type="button" onclick="callNewQuestionsPage()">Neue Frage anlegen</button> 
            </a>
            <a href="#responsive-header" class="block mt-4 w-1/8  pl-6  pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white text-base">
              <button id="new_category_button" class="button_main" type="button" onclick="callNewCategoryPage()">Neue Kategorie anlegen</button> 
            </a>
            <a href="#responsive-header" class="block mt-4 w-1/8 pl-6  pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white text-base">
              <button id="existing_questions_button" class="button_main" type="button" onclick="callExistingQuestionsPage()">Bestehende Fragen </button>
            </a>
            <a href="#responsive-header" class="block mt-4 w-1/8  pl-6  pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white text-base">
             Leistungsübersicht
            </a>
            <a href="#responsive-header" class="block mt-4 w-1/8 pl-6  pr-6 lg:inline-block lg:mt-0 text-teal-100 hover:text-white text-base">
              Nutzungsübersicht
            </a>
          </div>
      
      </div>
    
      </header>

      <div class="flex-col container pt-4 mx-auto mt-2 rounded shadow-md bg-gray-300 rounded px-8 pt-6 pb-4 mb-4">
    <h1 class="font-semibold text-3xl">Neue Frage anlegen </h1>
    <div>
    <p>Hier können Sie neue Fragen anlegen.</p>
    <p>Wählen Sie zunächste eine Kategorie bzw. eine Unterkategorie aus.</p>
    </div>
   
<div class="w-1/2 mt-4">
    <select id="selectCategorys" name="selectCategorys" size="1"  class="block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"> </select>
</div>     
    <div class="bg-gray-400 shadow-md rounded  mt-8 px-8 pt-6 pb-8 mb-4">
        <form id="FragenForm" name="FragenForm" class="form ">
            <label class="block mt-2 text-xl font-semibold mb-2" for="Frage">
                Frage
            </label>
            <input id="Frage" type="text" name="FragenText" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            
            <label class="block mt-2  text-xl font-semibold mb-2" for="Antwort1">
                Antwortmöglichkeit 1
            </label>
            <input type="text" name="Antwort1"  class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <br>

            <input type="radio" class="form-radio text-green-400 h-6 w-6" id="wahr1" name="Wahrheit1" value="true" >
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="wahr1"> Wahr</label>

            <input type="radio"  class="form-radio text-red-400 h-6 w-6 "id="falsch1" name="Wahrheit1" value="false">
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="falsch1"> Falsch</label>

     


            <label class="block mt-2 text-xl font-semibold mb-2" for="Antwort2">
                Antwortmöglichkeit 2
            </label>
            <input type="text" name="Antwort2" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">

            <input type="radio" class="form-radio text-green-400 h-6 w-6" id="wahr2" name="Wahrheit2" value="true" >
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="wahr2"> Wahr</label>

            <input type="radio"  class="form-radio text-red-400 h-6 w-6 "id="falsch2" name="Wahrheit2" value="false">
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="falsch2"> Falsch</label>


            <label class="block mt-2 text-xl font-semibold mb-2" for="Antwort3">
                Antwortmöglichkeit 3
            </label>
            <input type="text" name="Antwort3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">

            <input type="radio" class="form-radio text-green-400 h-6 w-6" id="wahr3" name="Wahrheit3" value="true" >
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="wahr3"> Wahr</label>

            <input type="radio"  class="form-radio text-red-400 h-6 w-6 "id="falsch3" name="Wahrheit3" value="false">
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="falsch3"> Falsch</label>

            <label class="block mt-2 text-xl font-semibold mb-2" for="Antwort4">
                Antwortmöglichkeit 4
            </label>
            <input type="text" name="Antwort4" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            
            <input type="radio" class="form-radio text-green-400 h-6 w-6" id="wahr4" name="Wahrheit4" value="true" >
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="wahr4"> Wahr</label>

            <input type="radio"  class="form-radio text-red-400 h-6 w-6 "id="falsch4" name="Wahrheit4" value="false">
            <label class="inline-flex items-center pl-2 mt-2 mr-2 h-12" for="falsch4"> Falsch</label>
            
            <input type="hidden" id="id" name="id">
            <input type="hidden" id="index" name="index">
            <div class="mt-4  flex items-center justify-between">
            <input type="submit"  id="update"name="update_button" value="Frage Hochladen" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 md:px-4 px-3 rounded focus:outline-none focus:shadow-outline" type="button" />
            <
        </div>
        </form>
    </div>
      </div>

    <!--
    <div>
        <form id="FragenForm" name="FragenForm" class="form">
            Neue Frage in dieser Kategorie eingeben:
            <br>
            <input type="text" name="FragenText">
            <br> Antwortmöglichkeit 1:
            <br>
            <input type="text" name="Antwort1">
            <input type="radio" id="wahr1" name="Wahrheit1" value="true">
            <label for="wahr1"> Wahr</label>
            <input type="radio" id="falsch1" name="Wahrheit1" value="false">
            <label for="falsch1"> Falsch</label>
            <br>
            <br /> Antwortmöglichkeit 2:
            <br>
            <input type="text" name="Antwort2">
            <input type="radio" id="wahr2" name="Wahrheit2" value="true">
            <label for="wahr2"> Wahr</label>
            <input type="radio" id="falsch2" name="Wahrheit2" value="false">
            <label for="falsch2"> Falsch</label>
            <br>
            <br /> Antwortmöglichkeit 3:
            <br>
            <input type="text" name="Antwort3">
            <input type="radio" id="wahr3" name="Wahrheit3" value="true">
            <label for="wahr3"> Wahr</label>
            <input type="radio" id="falsch3" name="Wahrheit3" value="false">
            <label for="falsch3"> Falsch</label>
            <br>
            <br/> Antwortmöglichkeit 4:
            <br>
            <input type="text" name="Antwort4">
            <input type="radio" id="wahr4" name="Wahrheit4" value="true">
            <label for="wahr4"> Wahr</label>
            <input type="radio" id="falsch4" name="Wahrheit4" value="false">
            <label for="falsch4"> Falsch</label>
            <br>
            <br />

            <input type="submit" value="Hinzufügen" onsubmit="consoleLog();" />
            <br />

        </form>
    </div>

-->
    

</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    const select = document.getElementById("selectCategorys");
    const myForm = document.getElementById("FragenForm");

    function loadData() {
        $.ajax({
            type: 'GET',
            url: 'https://projektseminarlfrb.herokuapp.com/categorys',
            data: {
                "category_name": 'IT-Business',
                "subcategory_name": 'Lock-in'
            },
            dataType: 'json',
            success: function(data) {
                //let questions = JSON.stringify(data); 
                console.table(data);

                if (data == undefined || data == null || data.length == 0) {
                    alert('Es konnten keine Kategorien geladen werden, wsl. sind noch keine Kategorien vorhanden');
                    window.location.href = './test_lernen.html';
                } else {
                    var string = JSON.stringify(data)
                    var json = JSON.parse(string)
                    fillInDataInDropdown(json)
                }
            },
            error: function(result) {
                console.log(result);
                alert("Es gab einen Fehler beim Laden der Daten!");
            }

        })
    }

    function fillInDataInDropdown(json) {
        for (var i = 0; i < json.length; i++) {
            var el = document.createElement("OPTGROUP");
            el.label = json[i].category_name;
            el.value = json[i].category_id;

            for (var j = 0; j < json[i].sub_categories.length; j++) {
                if(json[i].sub_categories[j].subcategory_id!= undefined){
                
                var ellsub = document.createElement("option");
                ellsub.label = json[i].sub_categories[j].subcategory_name;
                ellsub.value = json[i].sub_categories[j].subcategory_id;              
                ellsub.text=json[i].sub_categories[j].subcategory_name;
                el.appendChild(ellsub);
                }
            }
            select.appendChild(el)
        }
    }

    myForm.addEventListener("submit", (e) => {
        e.preventDefault();
        

        var x = document.forms["FragenForm"]["FragenText"].value;
        var y = document.forms["FragenForm"]["Antwort1"].value;
        var z = document.forms["FragenForm"]["Antwort2"].value;
        var ü = document.forms["FragenForm"]["Antwort3"].value;
        var l = document.forms["FragenForm"]["Antwort4"].value;

        if (formValidation(x, y, z, ü, l)) {

            boolean = turnBackRadioButton(document.getElementsByName('Wahrheit1'));
            boolean1 = turnBackRadioButton(document.getElementsByName('Wahrheit2'));
            boolean2 = turnBackRadioButton(document.getElementsByName('Wahrheit3'));
            boolean3 = turnBackRadioButton(document.getElementsByName('Wahrheit4'));

            var subcategory_id = document.getElementById("selectCategorys").value;
             sValue = $("option:selected", select).text()
            console.log(sValue)
            var selectBox = document.getElementById("selectCategorys");
            var op = selectBox.options[selectBox.selectedIndex];
            var optgroup = op.parentNode;

            var category_id = optgroup.value
            var category_name = optgroup.label
            alert(sValue);
            alert(subcategory_id)
            sendQuestion(x, y, z, ü, l, boolean, boolean1, boolean2, boolean3, category_name, category_id, subcategory_id, sValue);
        }

        document.getElementById("FragenForm").reset();

    })

    function sendQuestion(x, y, z, ü, l, boolean, boolean1, boolean2, boolean3, category_name, category_id, subcategory_id, subcategory_name) {
        $.ajax({
            type: 'POST',
            url: 'https://projektseminarlfrb.herokuapp.com/questions',
            data: JSON.stringify({
                "question": x,
                "category_id": category_id,
                "category_name": category_name,
                "subcategory_id": subcategory_id,
                "subcategory_name": subcategory_name,
                "answer": y,
                "boolean": boolean,
                "answer1": z,
                "boolean1": boolean1,
                "answer2": ü,
                "boolean2": boolean2,
                "answer3": l,
                "boolean3": boolean3
            }),
            dataType: 'json',
            contentType: 'application/json',
            success: function() {
                alert('Die Frage wurde erfolgreich hochgeladen');
            },
            error: function(result) {
                console.log(result);
                alert("Es gab einen Fehler beim Hochladen der Frage!");
            }

        })
    }

    function formValidation(x, y, z, ü, l) {
        console.log("Test der Validation")
        if (x == "") {
            window.alert("Bitte geben sie eine Frage ein.");
            return false;
        } else if (y == "") {
            window.alert("Bitte geben sie die erste Antwortmöglichkeit ein.");
            return false;
        } else if (z == "") {

            window.alert("Bitte geben sie die zweite Antwortmöglichkeit ein.");
            return false;
        } else if (ü == "") {

            window.alert("Bitte geben sie die dritte Antwortmöglichkeit ein.");
            return false;
        } else if (l = "") {
            window.alert("Bitte geben sie die vierte Antwortmöglichkeit ein.");
            return false;
        } else if (!validateRaioButtons(document.getElementsByName('Wahrheit1'))) {
            window.alert("Bitte geben Sie an ob die Erste Frage wahr oder Falsch sein soll!");
            return false;
        } else if (!validateRaioButtons(document.getElementsByName('Wahrheit2'))) {
            window.alert("Bitte geben Sie an ob die zweite Frage wahr oder Falsch sein soll!");
            return false;
        } else if (!validateRaioButtons(document.getElementsByName('Wahrheit3'))) {
            window.alert("Bitte geben Sie an ob die dritte Frage wahr oder Falsch sein soll!");
            return false;
        } else if (!validateRaioButtons(document.getElementsByName('Wahrheit4'))) {
            window.alert("Bitte geben Sie an ob die vierte Frage wahr oder Falsch sein soll!");
            return false;
        } else {
            return true;
        }

    }

    function validateRaioButtons(radios) {
        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
                // alert("Selected Value = " + radios[i].value);
                return true; // checked
                break;
            }
        }
        return false;
    }

    function turnBackRadioButton(radios) {
        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
                return radios[i].value;
            }
        }
    }

    loadData();
</script>

</html>